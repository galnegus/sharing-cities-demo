{"version":3,"sources":["assets/glb/room2.glb","SCCamera.js","render.js","Surface/SurfaceData.js","Surface/index.jsx","CameraContext.js","Surface/withMainSurface.js","Test.jsx","Surface/useGetAnchorData.js","Surface/AnchoredSurface.jsx","Surface/withSubSurface.js","Board/Pamphlet.jsx","Board/index.jsx","Map/scales.js","Map/Legend.jsx","Map/processLuftData.js","Map/index.jsx","App.jsx","serviceWorker.js","index.js"],"names":["module","exports","SCCamera","this","camera","PerspectiveCamera","window","innerWidth","innerHeight","defaultPosition","Vector3","defaultRotation","Euler","Math","PI","position","copy","rotation","transitionInfo","targetPosition","targetRotation","positionTween","rotationTween","transition","surface","up","mesh","fov","_Math","degToRad","q","dist","height","tan","worldPosition","getWorldPosition","getWorldDirection","multiplyScalar","add","startPosition","clone","startRotation","lookAt","goToOverview","Tween","easing","Easing","Cubic","Out","to","x","y","z","start","startQuaternion","Quaternion","setFromEuler","endQuaternion","t","on","slerp","quaternion","isPlaying","cameraOriginalPosition","cameraOriginalRotation","isTransitionRunning","scCamera","glScene","Scene","bgScene","cssScene","surfaceDeps","geometry","BoxGeometry","material","MeshPhongMaterial","color","emissive","specular","side","DoubleSide","flatShading","shininess","cube","Mesh","cubeShadow","castShadow","transparent","opacity","GLTFLoader","load","roomGLB","gltf","scene","scale","children","receiveShadow","pointLight","PointLight","shadow","mapSize","width","near","far","bgRenderer","WebGLRenderer","alpha","setClearColor","setPixelRatio","devicePixelRatio","setSize","domElement","style","top","left","shadowMap","enabled","document","getElementById","appendChild","cssRenderer","CSS3DRenderer","glRenderer","pointerEvents","onResize","debounce","aspect","updateProjectionMatrix","addEventListener","refresh","render","animate","time","requestAnimationFrame","update","MeshBasicMaterial","blending","NoBlending","SurfaceData","initialize","isClickable","resolutionScale","parent","originalPosition","originalRotation","originalUp","atOriginalPosition","element","createElement","object","CSS3DObject","set","PlaneBufferGeometry","destroy","remove","toCamera","manhattanDistanceTo","Number","EPSILON","moveTransition","moveToCamera","moveToOriginal","Surface","props","surfaceData","useRef","getSurfaceData","useCallback","current","useEffect","updateLayout","createPortal","className","fontSize","cloneElement","CameraContext","createContext","cameraView","setCameraView","withMainSurface","Component","useContext","isCameraHere","isCameraOverview","onClick","useState","test","setTest","useGetAnchorData","anchorRef","causeUpdate","anchorData","setAnchorData","useLayoutEffect","vertices","getAttribute","topLeft","localToWorld","getX","getY","getZ","origin","rightDirection","subVectors","downDirection","outDirection","normalize","anchorOffset","offset","offsetParent","offsetParentOffset","offsetLeft","offsetTop","offsetWidth","offsetHeight","addScaledVector","AnchoredSurface","ref","isCameraParent","withSubSurface","moveToggle","extraSurfaces","setExtraSurfaces","extras","map","surfaceProps","i","key","length","disabled","slice","EAQI_COLORS","good","fair","moderate","poor","veryPoor","EAQI_COLOR_RANGE","EAQI_PM10_LABELS","pm10ColorScale","scaleThreshold","domain","range","colorArrayToRgb","Legend","title","colors","unit","labels","Error","rectWidth","colorRects","fill","labelTexts","label","dy","textAnchor","transform","BaseControl","propTypes","PropTypes","string","isRequired","array","processLuftData","jsonArray","locationsObj","reduce","locations","row","location","sensor","measurement","hasOwnProperty","id","sensors","average_measurements","parseFloat","longitude","latitude","altitude","measurements","push","Object","keys","locationId","sensorId","measurementSums","sumObj","forEach","sensordatavalues","valueObj","value_type","sum","count","value","acc","data","tempData","console","log","zoom","bearing","pitch","viewport","setViewport","layers","ScatterplotLayer","lineWidthUnits","getRadius","getFillColor","d","P1","getLineColor","getLineWidth","viewState","onViewStateChange","controller","mapStyle","onViewportChange","farLeftWallProps","middleLeftWallProps","backWallProps","middleRightWallProps","farRightWallProps","Embedded","url","App","goToSurface","Provider","xmlns","viewBox","Boolean","hostname","match","ReactDOM","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"+JAAAA,EAAOC,QAAU,IAA0B,mC,ovQCGtBC,E,WACnB,aAAe,oBACbC,KAAKC,OAAS,IAAIC,IAAkB,GAAIC,OAAOC,WAAaD,OAAOE,YAAa,EAAG,KAEnFL,KAAKM,gBAAkB,IAAIC,KAAQ,EAAG,GAAI,KAC1CP,KAAKQ,gBAAkB,IAAIC,IAAM,EAAGC,KAAKC,GAAI,GAE7CX,KAAKC,OAAOW,SAASC,KAAKb,KAAKM,iBAC/BN,KAAKC,OAAOa,SAASD,KAAKb,KAAKQ,iBAE/BR,KAAKe,eAAiB,CACpBC,eAAgB,KAChBC,eAAgB,MAGlBjB,KAAKkB,cAAgB,KACrBlB,KAAKmB,cAAgB,K,2DAIrBnB,KAAKoB,WAAWpB,KAAKM,gBAAiBN,KAAKQ,mB,kCAGjCa,GACV,GAAgB,OAAZA,EAAJ,CAKArB,KAAKC,OAAOqB,GAAGT,KAAKQ,EAAQE,KAAKD,IAGjC,IACME,EAAMC,IAAMC,SAAS1B,KAAKC,OAAOuB,KACjCG,EAAI,IAAcxB,OAAOE,YACzBuB,EAAQP,EAAQQ,QAAU,EAAIF,IAAO,EAAIjB,KAAKoB,IAAIN,EAAM,IAExDO,EAAgB,IAAIxB,KAC1Bc,EAAQE,KAAKS,iBAAiBD,GAE9B,IAAMf,EAAiB,IAAIT,KAC3Bc,EAAQE,KAAKU,kBAAkBjB,GAC/BA,EAAekB,eAAeN,GAC9BZ,EAAemB,IAAIJ,GAEnB,IAAMK,EAAgBpC,KAAKC,OAAOW,SAASyB,QACrCC,EAAgBtC,KAAKC,OAAOa,SAASuB,QAE3CrC,KAAKC,OAAOW,SAASC,KAAKG,GAC1BhB,KAAKC,OAAOsC,OAAOR,GACnB,IAAMd,EAAiBjB,KAAKC,OAAOa,SAASuB,QAE5CrC,KAAKC,OAAOW,SAASC,KAAKuB,GAC1BpC,KAAKC,OAAOa,SAASD,KAAKyB,GAE1BtC,KAAKoB,WAAWJ,EAAgBC,QA9B9BjB,KAAKwC,iB,iCAiCExB,EAAgBC,GAAiB,IAAD,OACzCjB,KAAKe,eAAiB,CACpBC,iBACAC,kBAMFjB,KAAKkB,cAAgB,IAAIuB,QAAMzC,KAAKC,OAAOW,UAAU8B,OAAOC,SAAOC,MAAMC,KAAKC,GAAG,CAC/EC,EAAG/B,EAAe+B,EAClBC,EAAGhC,EAAegC,EAClBC,EAAGjC,EAAeiC,GALH,KAMJC,QAIb,IAAMC,EAAkB,IAAIC,IAC5BD,EAAgBE,aAAarD,KAAKC,OAAOa,UACzC,IAAMwC,EAAgB,IAAIF,IAC1BE,EAAcD,aAAapC,GAC3B,IAAIU,EAAI,IAAIyB,IACZpD,KAAKmB,cAAgB,IAAIsB,QAAM,CAACc,EAAG,IAAIT,GAAG,CAACS,EAAG,GAf7B,KAe2Cb,OAAOC,SAAOC,MAAMC,KAAKW,GAAG,UAAU,YAAS,IAAPD,EAAM,EAANA,EAClGH,IAAWK,MAAMN,EAAiBG,EAAe3B,EAAG4B,GACpD,EAAKtD,OAAOyD,WAAW7C,KAAKc,MAC3BuB,U,4CAIH,OAA2B,OAAvBlD,KAAKkB,eAAiD,OAAvBlB,KAAKmB,gBACjCnB,KAAKkB,cAAcyC,aAAe3D,KAAKmB,cAAcwC,e,+BAIrDtC,GACP,IAAMuC,EAAyB5D,KAAKC,OAAOW,SAASyB,QAC9CwB,EAAyB7D,KAAKC,OAAOa,SAASuB,QAChDjB,EAAapB,KAAK8D,sBAClB1C,IACFpB,KAAKC,OAAOW,SAASC,KAAKb,KAAKe,eAAeC,gBAC9ChB,KAAKC,OAAOa,SAASD,KAAKb,KAAKe,eAAeE,iBAIhD,IACMO,EAAMC,IAAMC,SAAS1B,KAAKC,OAAOuB,KACjCG,EAAI,IAAcxB,OAAOE,YACzBuB,EAAQP,EAAQQ,QAAU,EAAIF,IAAO,EAAIjB,KAAKoB,IAAIN,EAAM,IAExDO,EAAgB,IAAIxB,KAC1BP,KAAKC,OAAO+B,iBAAiBD,GAE7B,IAAMf,EAAiB,IAAIT,KAC3BP,KAAKC,OAAOgC,kBAAkBjB,GAC9BA,EAAekB,eAAeN,GAC9BZ,EAAemB,IAAIJ,GAEnB,IAAMK,EAAgBf,EAAQE,KAAKX,SAASyB,QACtCC,EAAgBjB,EAAQE,KAAKT,SAASuB,QAE5ChB,EAAQE,KAAKX,SAASC,KAAKG,GAC3BK,EAAQE,KAAKgB,OAAOR,GACpB,IAAMd,EAAiBI,EAAQE,KAAKT,SAASuB,QAS7C,OAPAhB,EAAQE,KAAKX,SAASC,KAAKuB,GAC3Bf,EAAQE,KAAKT,SAASD,KAAKyB,GAEvBlB,IACFpB,KAAKC,OAAOW,SAASC,KAAK+C,GAC1B5D,KAAKC,OAAOa,SAASD,KAAKgD,IAErB,CAAC7C,EAAgBC,O,uBC5Hf8C,EAAW,IAAIhE,EACtBiE,EAAU,IAAIC,KACdC,EAAU,IAAID,KACdE,EAAW,IAAIF,KACRG,EAAc,CAAEJ,UAASG,WAAUlE,OAAQ8D,GAGlDM,EAAW,IAAIC,IAAY,IAAK,IAAK,KACrCC,EAAW,IAAIC,IAAkB,CACrCC,MAAO,SACPC,SAAU,EACVC,SAAU,QACVC,KAAMC,IACNC,aAAa,EACbC,UAAW,KAEPC,EAAO,IAAIC,IAAKZ,EAAUE,GAChCS,EAAKpE,SAASqC,GAAK,IACnB+B,EAAKpE,SAASmC,EAAI,IAClBiC,EAAKpE,SAASoC,EAAI,IAClBgB,EAAQ7B,IAAI6C,GAEZ,IAAME,EAAa,IAAID,IAAKZ,EAAUE,EAASlC,SAC/C6C,EAAWC,YAAa,EACxBD,EAAWX,SAASa,aAAc,EAClCF,EAAWX,SAASc,QAAU,EAC9BH,EAAWtE,SAASC,KAAKmE,EAAKpE,UAC9BsD,EAAQ/B,IAAI+C,IAEG,IAAII,KAUZC,KAAKC,KAAS,SAAUC,GAC7BA,EAAKC,MAAMC,MAAMzD,eAAe,KAChCuD,EAAKC,MAAM5E,SAASkC,EAAItC,KAAKC,GAC7B8E,EAAKC,MAAM9E,SAASoC,GAAK,IACzByC,EAAKC,MAAM9E,SAASqC,GAAK,IACzBwC,EAAKC,MAAM9E,SAASmC,GAAK,KACzB0C,EAAKC,MAAME,SAAS,GAAGC,eAAgB,EACvC3B,EAAQ/B,IAAIsD,EAAKC,UAInB,IAAMI,EAAa,IAAIC,IAAW,SAAU,GAAK,EAAG,GACpDD,EAAWX,YAAa,EACxBW,EAAWlF,SAASqC,GAAK,IACzB6C,EAAWE,OAAOC,QAAQC,MAAQ,KAClCJ,EAAWE,OAAOC,QAAQpE,OAAS,KACnCiE,EAAWE,OAAO/F,OAAOkG,KAAO,GAChCL,EAAWE,OAAO/F,OAAOmG,IAAM,IAC/BpC,EAAQ7B,IAAI2D,GACZ5B,EAAQ/B,KAAI,IAAI4D,KAAalF,KAAKiF,IAOlC,IAAMO,EAAa,IAAIC,KAAc,CAAEC,OAAO,IAC9CF,EAAWG,cAAc,EAAU,GACnCH,EAAWI,cAActG,OAAOuG,kBAChCL,EAAWM,QAAQxG,OAAOC,WAAYD,OAAOE,aAC7CgG,EAAWO,WAAWC,MAAMjG,SAAW,WACvCyF,EAAWO,WAAWC,MAAMC,IAAM,EAClCT,EAAWO,WAAWC,MAAME,KAAO,EACnCV,EAAWW,UAAUC,SAAU,EAC/BC,SAASC,eAAe,UAAUC,YAAYf,EAAWO,YAEzD,IAAMS,EAAc,IAAIC,IACxBD,EAAYV,QAAQxG,OAAOC,WAAYD,OAAOE,aAC9CgH,EAAYT,WAAWC,MAAMjG,SAAW,WACxCyG,EAAYT,WAAWC,MAAMC,IAAM,EACnCO,EAAYT,WAAWC,MAAME,KAAO,EACpCG,SAASC,eAAe,UAAUC,YAAYC,EAAYT,YAE1D,IAAMW,EAAa,IAAIjB,KAAc,CAAEC,OAAO,IAC9CgB,EAAWf,cAAc,EAAU,GACnCe,EAAWd,cAActG,OAAOuG,kBAChCa,EAAWZ,QAAQxG,OAAOC,WAAYD,OAAOE,aAC7CkH,EAAWX,WAAWC,MAAMjG,SAAW,WACvC2G,EAAWX,WAAWC,MAAMC,IAAM,EAClCS,EAAWX,WAAWC,MAAME,KAAO,EACnCQ,EAAWX,WAAWC,MAAMW,cAAgB,OAC5CN,SAASC,eAAe,UAAUC,YAAYG,EAAWX,YAEzD,IAAMa,EAAWC,KAAS,WACxB3D,EAAS9D,OAAO0H,OAASxH,OAAOC,WAAaD,OAAOE,YACpD0D,EAAS9D,OAAO2H,yBAChBvB,EAAWM,QAAQxG,OAAOC,WAAYD,OAAOE,aAC7CgH,EAAYV,QAAQxG,OAAOC,WAAYD,OAAOE,aAC9CkH,EAAWZ,QAAQxG,OAAOC,WAAYD,OAAOE,eAC5C,KACHF,OAAO0H,iBAAiB,SAAUJ,GAE3B,IAAMK,EAAU,WACrBzB,EAAW0B,OAAO7D,EAASH,EAAS9D,QACpCoH,EAAYU,OAAO5D,EAAUJ,EAAS9D,QACtCsH,EAAWQ,OAAO/D,EAASD,EAAS9D,UAGtB,SAAV+H,EAAWC,GACfC,sBAAsBF,GAEtBhD,EAAKlE,SAASiC,GAAK,IACnBmC,EAAWpE,SAASiC,GAAK,IACzBiC,EAAKlE,SAASkC,GAAK,IACnBkC,EAAWpE,SAASkC,GAAK,IACzBqD,EAAW0B,OAAO7D,EAASH,EAAS9D,QACpCoH,EAAYU,OAAO5D,EAAUJ,EAAS9D,QACtCsH,EAAWQ,OAAO/D,EAASD,EAAS9D,QACpCkI,iBAAOF,GAGTD,G,WC1HMzD,EAAW,IAAI6D,IAAkB,CACrC/C,QAAS,EACTZ,MAAO,EACPG,KAAMC,IACNwD,SAAUC,MAGSC,E,WACnB,aAAsB,oBACpBvI,KAAKwI,WAAL,MAAAxI,KAAA,W,0DAGwI,IAAD,OAA5HkG,EAA4H,EAA5HA,MAAOrE,EAAqH,EAArHA,OAAQjB,EAA6G,EAA7GA,SAAUE,EAAmG,EAAnGA,SAAUQ,EAAyF,EAAzFA,GAAI0C,EAAqF,EAArFA,QAASG,EAA4E,EAA5EA,SAAUlE,EAAkE,EAAlEA,OAAkE,KAA1DwI,YAA0D,EAAtCC,wBAAsC,MAApB,EAAoB,MAAjBC,cAAiB,MAAR,KAAQ,EACvI3I,KAAKkG,MAAQA,EACblG,KAAK6B,OAASA,EACd7B,KAAK0I,gBAAkBA,EACvB1I,KAAK4I,iBAAmBhI,EAASyB,QACjCrC,KAAK6I,iBAAmB/H,EAASuB,QACjCrC,KAAK8I,WAAaxH,EAAGe,QACrBrC,KAAK+I,oBAAqB,EAE1B/I,KAAK2I,OAASA,EACd3I,KAAKC,OAASA,EAEdD,KAAKgJ,QAAU9B,SAAS+B,cAAc,OACtCjJ,KAAKgJ,QAAQnC,MAAMX,MAAnB,UAA8BA,EAAQlG,KAAK0I,gBAA3C,MACA1I,KAAKgJ,QAAQnC,MAAMhF,OAAnB,UAA+BA,EAAS7B,KAAK0I,gBAA7C,MACA1I,KAAKgJ,QAAQnC,MAAMxB,QAAU,EAE7BrF,KAAKkJ,OAAS,IAAIC,IAAYnJ,KAAKgJ,SACnChJ,KAAKkJ,OAAOtI,SAASC,KAAKD,GAC1BZ,KAAKkJ,OAAOpI,SAASD,KAAKC,GAC1Bd,KAAKkJ,OAAOvD,MAAMyD,IAAI,EAAIpJ,KAAK0I,gBAAiB,EAAI1I,KAAK0I,gBAAiB,EAAI1I,KAAK0I,iBAEnF1I,KAAKqE,SAAW,IAAIgF,IAAoBnD,EAAOrE,GAC/C7B,KAAKuB,KAAO,IAAI0D,IAAKjF,KAAKqE,SAAUE,GACpCvE,KAAKuB,KAAKX,SAASC,KAAKD,GACxBZ,KAAKuB,KAAKT,SAASD,KAAKC,GACxBd,KAAKuB,KAAKD,GAAKA,EACftB,KAAKuB,KAAK4D,YAAa,EACvBnF,KAAKuB,KAAKsE,eAAgB,EAG1B7B,EAAQ7B,IAAInC,KAAKuB,MACjB4C,EAAShC,IAAInC,KAAKkJ,QAClBpB,IAGA9H,KAAKsJ,QAAU,WACbtF,EAAQuF,OAAO,EAAKhI,MACpB4C,EAASoF,OAAO,EAAKL,QACrBpB,O,mCAISlH,EAAUE,EAAUQ,GAC/BtB,KAAK4I,iBAAmBhI,EAASyB,QACjCrC,KAAK6I,iBAAmB/H,EAASuB,QACjCrC,KAAK8I,WAAaxH,EAAGe,QAErBrC,KAAKkJ,OAAOtI,SAASC,KAAKD,GAC1BZ,KAAKkJ,OAAOpI,SAASD,KAAKC,GAC1Bd,KAAKuB,KAAKX,SAASC,KAAKD,GACxBZ,KAAKuB,KAAKT,SAASD,KAAKC,GACxBd,KAAKuB,KAAKD,GAAKA,I,qCAGD,IAAD,EACgBtB,KAAKC,OAAOuJ,SAASxJ,MADrC,mBACNY,EADM,KACIE,EADJ,KAETd,KAAKuB,KAAKX,SAAS6I,oBAAoB7I,GAAY8I,OAAOC,UAE9D3J,KAAK4J,eAAehJ,EAAUE,GAC9Bd,KAAK+I,oBAAqB,K,uCAItB/I,KAAKuB,KAAKX,SAAS6I,oBAAoBzJ,KAAK4I,kBAAoBc,OAAOC,UAE3E3J,KAAK4J,eAAe5J,KAAK4I,iBAAkB5I,KAAK6I,kBAChD7I,KAAK+I,oBAAqB,K,mCAItB/I,KAAK+I,mBAAoB/I,KAAK6J,eAC7B7J,KAAK8J,mB,qCAGG9I,EAAgBC,GAAiB,IAAD,OAI7C,IAAIwB,QAAMzC,KAAKkJ,OAAOtI,UAAU8B,OAAOC,SAAOC,MAAMC,KAAKC,GAAG,CAC1DC,EAAG/B,EAAe+B,EAClBC,EAAGhC,EAAegC,EAClBC,EAAGjC,EAAeiC,GALH,KAMJC,QACb,IAAIT,QAAMzC,KAAKuB,KAAKX,UAAU8B,OAAOC,SAAOC,MAAMC,KAAKC,GAAG,CACxDC,EAAG/B,EAAe+B,EAClBC,EAAGhC,EAAegC,EAClBC,EAAGjC,EAAeiC,GAVH,KAWJC,QAIb,IAAMC,EAAkB,IAAIC,IAC5BD,EAAgBE,aAAarD,KAAKuB,KAAKT,UACvC,IAAMwC,EAAgB,IAAIF,IAC1BE,EAAcD,aAAapC,GAC3B,IAAIU,EAAI,IAAIyB,IACZ,IAAIX,QAAM,CAACc,EAAG,IAAIT,GAAG,CAACS,EAAG,GApBR,KAoBsBb,OAAOC,SAAOC,MAAMC,KAAKW,GAAG,UAAU,YAAS,IAAPD,EAAM,EAANA,EAC7EH,IAAWK,MAAMN,EAAiBG,EAAe3B,EAAG4B,GACpD,EAAKhC,KAAKmC,WAAW7C,KAAKc,GAC1B,EAAKuH,OAAOxF,WAAW7C,KAAKc,MAC3BuB,Y,KC9DQ6G,MAjDf,SAAiBC,GAEf,IAAMC,EAAcC,iBAAO,MAGrBC,EAAiBC,uBACrB,WACE,OAA4B,OAAxBH,EAAYI,QAAyBJ,EAAYI,SACrDJ,EAAYI,QAAU,IAAI9B,EAAYyB,GAC/BC,EAAYI,WAErB,CAACL,IAeH,OAXAM,qBAAU,WACRH,IAAiBI,aAAaP,EAAMpJ,SAAUoJ,EAAMlJ,SAAUkJ,EAAM1I,MACnE,CAAC6I,EAAgBH,EAAMpJ,SAAUoJ,EAAMlJ,SAAUkJ,EAAM1I,KAG1DgJ,qBAAU,WACR,OAAO,WACLL,EAAYI,QAAQf,aAErB,IAEIkB,uBACL,yBAAKC,UAAU,UAAU5D,MAAO,CAAE6D,SAAS,GAAD,OAAK,GAAKP,IAAiBzB,gBAA3B,QACvCiC,uBAAaX,EAAMpE,SAAU,CAAEvE,QAAS8I,OAE1CA,IAAiBnB,UC/BP4B,EALOC,wBAAc,CAClCC,WAAY,KACZC,cAAe,OCAF,SAASC,EAAgBC,GAwBtC,OAvBA,SAAqBjB,GAAQ,IAAD,EACYkB,qBAAWN,GAAzCE,EADkB,EAClBA,WAAYC,EADM,EACNA,cAEdI,EAAeL,IAAed,EAAM3I,QACpC+J,EAAkC,OAAfN,EAEzB,OACE,kBAAC,WAAD,KACE,yBAAKL,UAAS,2BAAuBU,EAAgD,GAAjC,iCAClD,kBAACF,EAAcjB,IAEjB,yBACES,UAAS,2BAAuBW,EAAgD,GAA7B,4BACnDC,QAAS,kBAAMN,EAAcf,EAAM3I,c,OCU9B2J,SAtBf,SAAchB,GAAQ,IAAD,EACKsB,mBAAS,GADd,mBACZC,EADY,KACNC,EADM,KAIbL,EAFiBD,qBAAWN,GAA1BE,aAE4Bd,EAAM3I,QAE1C,OACE,yBAAKoJ,UAAU,QACb,2CACA,2BAAIc,GACDJ,GACC,8CAEJ,4BAAQE,QAAS,kBAAMG,EAAQD,EAAO,KAAtC,gB,SCJS,SAASE,EAAiBpK,EAASqK,EAAWC,GAAc,IAAD,EACpCL,mBAAS,MAD2B,mBACjEM,EADiE,KACrDC,EADqD,KAqCxE,OAlCAC,2BAAgB,WAEd,IAAMC,EAAW1K,EAAQgD,SAAS2H,aAAa,YAEzCC,EAAU5K,EAAQE,KAAK2K,aAAa,IAAI3L,KAAQwL,EAASI,KADrD,GAC8DJ,EAASK,KADvE,GACgFL,EAASM,KADzF,KAGJC,EAAS,IAAI/L,KACnBc,EAAQE,KAAKS,iBAAiBsK,GAC9B,IAAMC,GAAiB,IAAIhM,MAAUiM,WAAWnL,EAAQE,KAAK2K,aAAa,IAAI3L,KAAQ,EAAG,EAAG,IAAK+L,GAC3FG,GAAgB,IAAIlM,MAAUiM,WAAWnL,EAAQE,KAAK2K,aAAa,IAAI3L,KAAQ,GAAI,EAAG,IAAK+L,GAC3FI,EAAe,IAAInM,KACzBc,EAAQE,KAAKU,kBAAkByK,GAE/BH,EAAeI,YACfF,EAAcE,YACdD,EAAaC,YACb,IAAMC,EA7BV,SAASC,EAAO7D,GACd,GAA6B,OAAzBA,EAAQ8D,aAAuB,MAAO,CAAE/F,KAAM,EAAGD,IAAK,GAC1D,GAA0B,YAAtBkC,EAAQyB,UAAyB,MAAO,CAAE1D,KAAM,EAAGD,IAAK,GAC5D,IAAMiG,EAAqBF,EAAO7D,EAAQ8D,cAC1C,MAAO,CACL/F,KAAMgG,EAAmBhG,KAAOiC,EAAQgE,WACxClG,IAAKiG,EAAmBjG,IAAMkC,EAAQiE,WAuBjBJ,CAAOnB,EAAUrB,SACtCuC,EAAa7F,MAAQ2E,EAAUrB,QAAQ6C,YAAc,EACrDN,EAAa9F,KAAO4E,EAAUrB,QAAQ8C,aAAe,EACrDP,EAAa7F,MAAQ1F,EAAQqH,gBAC7BkE,EAAa9F,KAAOzF,EAAQqH,gBAE5B,IAAM9H,EAAWqL,EAAQ5J,QACzBzB,EAASwM,gBAAgBb,EAAgBK,EAAa7F,MACnDqG,gBAAgBX,EAAeG,EAAa9F,KAC5CsG,gBAAgBV,EAAc,IAEjCb,EAAc,CACZjL,WACAE,SAAUO,EAAQE,KAAKT,SAASuB,QAChCf,GAAID,EAAQE,KAAKD,GAAGe,YAErB,CAAChB,EAASqK,EAAWC,IAEjBC,ECXMyB,MAnCf,SAAyBrD,GACvB,IAAM0B,EAAYxB,iBAAO,MACnB0B,EAAaH,EAAiBzB,EAAMrB,OAAQ+C,EAAW1B,EAAM2B,aAEnE,OACE,yBACElB,UAAU,SACV6C,IAAK5B,EACL7E,MAAO,CACLX,MAAO8D,EAAM9D,MAAQ8D,EAAMrB,OAAOD,gBAClC7G,OAAQmI,EAAMnI,OAASmI,EAAMrB,OAAOD,kBAGrCkD,GACC,kBAAC,EAAD,eACEhL,SAAUgL,EAAWhL,SACrBE,SAAU8K,EAAW9K,SACrBQ,GAAIsK,EAAWtK,IACX0I,GAEHA,EAAMpE,YCtBX2H,EAAiB,SAAjBA,EAAkBzC,EAAYnC,GAClC,OAAe,OAAXA,IACAmC,IAAenC,GACZ4E,EAAezC,EAAYnC,EAAOA,U,OCK5B6E,IDFwBvC,ECExBuC,GDFwBvC,ECNvC,SAAkBjB,GAChB,OACE,yBAAKS,UAAU,YAAf,QDKF,SAAoBT,GAAQ,IAClBc,EAAeI,qBAAWN,GAA1BE,WAiBR,OAdAR,qBAAU,WACJiD,EAAezC,EAAYd,EAAM3I,QAAQsH,QAC3CqB,EAAM3I,QAAQ6H,OAAOF,QAAQyB,UAAY,GAEzCT,EAAM3I,QAAQ6H,OAAOF,QAAQyB,UAAY,wBAE1C,CAACK,EAAYd,EAAM3I,UAGtBiJ,qBAAU,WACW,OAAfQ,GACJd,EAAM3I,QAAQyI,mBACb,CAACgB,EAAYd,EAAM3I,UAGpB,kBAAC,WAAD,KACE,yBAAKoJ,UAAU,oBACb,kBAACQ,EAAcjB,IAEjB,yBACES,UAAS,2BAAuB8C,EAAezC,EAAYd,EAAM3I,QAAQsH,QAAuC,GAA7B,4BACnF0C,QAAS,kBAAMrB,EAAM3I,QAAQoM,mB,gkBEmDxBzC,SA/Ef,SAAehB,GAAQ,IAAD,EACsBsB,mBAAS,IAD/B,mBACboC,EADa,KACEC,EADF,KAGdC,EACJ,kBAAC,WAAD,KACGF,EAAcG,KAAI,SAACC,EAAcC,GAAf,OACjB,kBAAC,EAAD,eAAiBC,IAAKD,GAAOD,EAA7B,CAA2CnC,YAAa+B,EAAcO,SACpE,kBAAC,EAAD,WAMR,OACE,yBAAKxD,UAAU,SACb,yBAAKA,UAAU,kBACb,yBAAKA,UAAU,kBACb,4BACEY,QAAS,kBAAMsC,EAAiB,GAAD,mBAAKD,GAAL,IAC7BxH,MAAO,IACPrE,OAAQ,IACR8G,OAAQqB,EAAM3I,QACdqH,gBAAiB,GACdtE,QANP,KAWA,4BACE8J,SAAmC,IAAzBR,EAAcO,OACxB5C,QAAS,kBAAMsC,EAAiBD,EAAcS,MAAM,GAAI,MAF1D,MAOF,yBAAK1D,UAAU,oBACb,kBAAC,EAAD,eACEvE,MAAO,IACPrE,OAAQ,IACR8G,OAAQqB,EAAM3I,QACdqH,gBAAiB,EACjBiD,YAAa+B,EAAcO,QACvB7J,GAEJ,kBAAC,EAAD,OAEF,kBAAC,EAAD,eACE8B,MAAO,IACPrE,OAAQ,IACR8G,OAAQqB,EAAM3I,QACdqH,gBAAiB,EACjBiD,YAAa+B,EAAcO,QACvB7J,GAEJ,kBAAC,EAAD,OAEF,kBAAC,EAAD,eACE8B,MAAO,IACPrE,OAAQ,IACR8G,OAAQqB,EAAM3I,QACdqH,gBAAiB,EACjBiD,YAAa+B,EAAcO,QACvB7J,GAEJ,kBAAC,EAAD,OAGDwJ,Q,qCCxEEQ,GAAc,CACzBC,KAAM,CAAC,GAAI,IAAK,IAAK,KACrBC,KAAM,CAAC,GAAI,IAAK,IAAK,KACrBC,SAAU,CAAC,IAAK,IAAK,GAAI,KACzBC,KAAM,CAAC,IAAK,GAAI,GAAI,KACpBC,SAAU,CAAC,IAAK,EAAG,GAAI,MAGZC,GAAmB,CAC9BN,GAAYC,KACZD,GAAYE,KACZF,GAAYG,SACZH,GAAYI,KACZJ,GAAYK,UAODE,GAAmB,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,UAMxCC,IAJkBC,eAC1BC,OAP4B,CAAC,GAAI,GAAI,GAAI,KAQzCC,MAAML,IAEmBG,eACzBC,OAV2B,CAAC,GAAI,GAAI,GAAI,MAWxCC,MAAML,K,wDC1BX,SAASM,GAAgBvK,GACvB,MAAM,QAAN,OAAeA,EAAM,GAArB,aAA4BA,EAAM,GAAlC,aAAyCA,EAAM,GAA/C,aAAsDA,EAAM,GAAK,IAAjE,KAGF,IAKMwK,G,qLACO,IAAD,EACgCjP,KAAKgK,MAArCkF,EADA,EACAA,MAAaC,GADb,EACOC,KADP,EACaD,QAAQE,EADrB,EACqBA,OAE7B,GAAIF,EAAOlB,SAAWoB,EAAOpB,OAAS,EACpC,MAAM,IAAIqB,MAAM,4CAElB,IAAMC,EAZI,IAYgBJ,EAAOlB,OAC3BuB,EAAaL,EAAOtB,KAAI,SAACpJ,EAAOsJ,GAAR,OAC5B,0BAAM7H,MAAOqJ,EAAW1N,OAbf,GAa+BkB,EAAGwM,EAAYxB,EAAG0B,KAAMT,GAAgBG,EAAOpB,IAAKC,IAAKD,OAG7F2B,EAAaL,EAAOxB,KAAI,SAAC8B,EAAO5B,GAAR,OAC5B,0BAAMhL,EAAGwM,EAAYxB,EAAG6B,GAAG,QAAQC,WAAW,SAAS7B,IAAKD,GAAI4B,MAGlE,OACE,yBAAKlF,UAAU,cACb,yBAAKvE,MAAOA,IAAoBrE,OAAQA,IACtC,uBAAGiO,UAAS,oBAtBP,GAsBO,YAtBP,GAsBO,MACV,2BACE,0BAAM/M,EAAGmD,IAAW0J,GAAG,IAAIC,WAAW,SAASpF,UAAU,qBAAqByE,IAEhF,uBAAGY,UAAS,mBACTN,GAEH,uBAAGM,UAAS,sBAAiBjO,GAAjB,MACT6N,U,GA3BMK,KAoCrBd,GAAOe,UAAY,CACjBd,MAAOe,KAAUC,OAAOC,WACxBf,KAAMa,KAAUC,OAChBf,OAAQc,KAAUG,MAAMD,WACxBd,OAAQY,KAAUG,MAAMD,YAGXlB,U,ukBCFAoB,OA/Cf,SAAyBC,GAEvB,IAAMC,EAAeD,EAAUE,QAAO,SAACC,EAAWC,GAAS,IACjDC,EAAqCD,EAArCC,SAAUC,EAA2BF,EAA3BE,OAAWC,EAD2B,aACXH,EADW,uBAaxD,OAXKD,EAAUK,eAAeH,EAASI,MACrCN,EAAUE,EAASI,IAAM,CACvBC,QAAS,GACTC,qBAAsB,KACtBrQ,SAAU,CAACsQ,WAAWP,EAASQ,WAAYD,WAAWP,EAASS,UAAWF,WAAWP,EAASU,aAG7FZ,EAAUE,EAASI,IAAIC,QAAQF,eAAeF,EAAOG,MACxDN,EAAUE,EAASI,IAAIC,QAAQJ,EAAOG,IAAtC,MAAiDH,EAAjD,CAAyDU,aAAc,MACzEb,EAAUE,EAASI,IAAIC,QAAQJ,EAAOG,IAAIO,aAAaC,KAAvD,MAAiEV,IAE1DJ,IACN,IAGH,OAAOe,OAAOC,KAAKlB,GAAc1C,KAAI,SAAA6D,GACnC,IAAMf,EAAWJ,EAAamB,GAC9Bf,EAASK,QAAUQ,OAAOC,KAAKd,EAASK,SAASnD,KAAI,SAAA8D,GAAQ,OAAIhB,EAASK,QAAQW,MAGlF,IAAMC,EAAkBjB,EAASK,QAAQR,QAAO,SAACqB,EAAQjB,GAUvD,OATAA,EAAOU,aAAaQ,SAAQ,SAAAjB,GAC1BA,EAAYkB,iBAAiBD,SAAQ,SAAAE,GAC/BH,EAAOf,eAAekB,EAASC,cACjCJ,EAAOG,EAASC,YAAc,CAAEC,IAAK,EAAGC,MAAO,IAEjDN,EAAOG,EAASC,YAAYC,KAAOhB,WAAWc,EAASI,OACvDP,EAAOG,EAASC,YAAYE,OAAS,QAGlCN,IACN,IAOH,OALAlB,EAASM,qBAAuBO,OAAOC,KAAKG,GAAiBpB,QAAO,SAAC6B,EAAKJ,GAAN,aAC7DI,EAD6D,eAE/DJ,EAAaL,EAAgBK,GAAYC,IAAMN,EAAgBK,GAAYE,UAC5E,IAEGxB,M,UCpCL2B,I,OAAOjC,GAAgBkC,KAC7BC,QAAQC,IAAIH,IAuDGtH,UArDf,WAAgB,IAAD,EACmBM,mBAAS,CACvC8F,SAAU,UACVD,UAAW,UACXuB,KAAM,GACNC,QAAS,EACTC,MAAO,EACP1M,MAAO,IACPrE,OAAQ,MARG,mBACNgR,EADM,KACIC,EADJ,KAWPC,EAAS,CACb,IAAIC,IAAiB,CACnBjC,GAAI,kBACJuB,QACAW,eAAgB,SAChBC,UAAW,GACXC,aAAc,SAAAC,GAAC,OAAIxE,GAAewE,EAAEnC,qBAAqBoC,KACzDC,aAAc,CAAC,EAAG,EAAG,EAAG,KACxBC,aAAc,MAIlB,OACE,6BACE,kBAAC,IAAD,CACEC,UAAWX,EACXY,kBAAmB,gBAAGD,EAAH,EAAGA,UAAH,OAAmBV,EAAYU,IAClDT,OAAQA,EACRW,YAAY,GAEZ,kBAAC,IAAD,CACEC,SAAS,4DAET,yBAAKlJ,UAAU,8BACb,kBAAC,IAAD,CACEmJ,iBAAkB,SAACJ,GAAD,OAAeV,EAAYU,OAIjD,yBAAK/I,UAAU,6BACb,kBAAC,GAAD,CACEyE,MAAM,OACNC,OAAQT,GACRW,OAAQV,Y,okBChDtB,IAAMkF,GAAgB,IACpB3N,MAAO,IACPrE,OAAQ,IACRjB,SAAU,IAAIL,KAAQ,KAAM,GAAI,KAChCO,SAAU,IAAIL,IAAM,GAAI,EAAIC,KAAKC,GAAK,EAAG,GACzCW,GAAI,IAAIf,KAAQ,EAAG,EAAG,IACnB6D,GAEC0P,GAAmB,IACvB5N,MAAO,IACPrE,OAAQ,IACRjB,SAAU,IAAIL,KAAQ,IAAK,GAAI,KAC/BO,SAAU,IAAIL,IAAM,GAAI,EAAIC,KAAKC,GAAK,EAAG,GACzCW,GAAI,IAAIf,KAAQ,EAAG,EAAG,IACnB6D,GAEC2P,GAAa,IACjB7N,MAAO,IACPrE,OAAQ,IACRjB,SAAU,IAAIL,KAAQ,EAAG,GAAI,IAC7BO,SAAU,IAAIL,IAAM,EAAGC,KAAKC,GAAI,GAChCW,GAAI,IAAIf,KAAQ,EAAG,EAAG,IACnB6D,GAEC4P,GAAoB,IACxB9N,MAAO,IACPrE,OAAQ,IACRjB,SAAU,IAAIL,MAAS,IAAK,GAAI,KAChCO,SAAU,IAAIL,IAAM,EAAG,EAAIC,KAAKC,GAAK,EAAG,GACxCW,GAAI,IAAIf,KAAQ,EAAG,EAAG,IACnB6D,GAEC6P,GAAiB,IACrB/N,MAAO,IACPrE,OAAQ,IACRjB,SAAU,IAAIL,MAAS,KAAM,GAAI,KACjCO,SAAU,IAAIL,IAAM,EAAG,EAAIC,KAAKC,GAAK,EAAG,GACxCW,GAAI,IAAIf,KAAQ,EAAG,EAAG,IACnB6D,GAGC8P,GAAWlJ,GAAgB,WAC/B,OACE,yBAAKP,UAAU,YACb,yBAAKsG,GAAG,+BACR,kBAAC,IAAD,CAAOoD,IAAI,oDAgEFC,OA3Df,SAAapK,GAAQ,IAAD,EACkBsB,mBAAS,MAD3B,mBACXR,EADW,KACCC,EADD,KAOlB,OAJAT,qBAAU,WACRvG,EAASsQ,YAAYvJ,KACpB,CAACA,IAGF,kBAAC,WAAD,KACE,kBAAC,EAAcwJ,SAAf,CACElC,MAAO,CACLtH,aACAC,kBAGF,kBAAC,EAAY8I,GACX,kBAAC,EAAD,OAEF,kBAAC,EAAYC,GACX,kBAACI,GAAD,OAEF,kBAAC,EAAYH,GACX,kBAAC,EAAD,OAEF,kBAAC,EAAYC,GACX,kBAAC,GAAD,OAEF,kBAAC,EAAYC,GACX,kBAAC,EAAD,QAIJ,yBAAKxJ,UAAU,OACb,yBAAKA,UAAU,iBACf,yBAAKA,UAAU,gBACG,OAAfK,GACC,yBACEL,UAAU,uBACVY,QAAS,kBAAMN,EAAc,QAE7B,yBACEwJ,MAAM,6BACNrO,MAAM,KACNrE,OAAO,KACP2S,QAAQ,aAER,0BAAMpB,EAAE,qFAEV,6BACE,wDCpGIqB,QACW,cAA7BtU,OAAOwQ,SAAS+D,UAEe,UAA7BvU,OAAOwQ,SAAS+D,UAEhBvU,OAAOwQ,SAAS+D,SAASC,MACvB,2DCXNC,IAAS7M,OAAO,kBAAC,GAAD,MAASb,SAASC,eAAe,SD0H3C,kBAAmB0N,WACrBA,UAAUC,cAAcC,MAAMC,MAAK,SAAAC,GACjCA,EAAaC,kB","file":"static/js/main.c4b78eb7.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/room2.2b221fd9.glb\";","import { PerspectiveCamera, Vector3, Euler, Math as _Math, Quaternion } from 'three';\r\nimport { Tween, Easing } from 'es6-tween';\r\n\r\nexport default class SCCamera {\r\n  constructor() {\r\n    this.camera = new PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);\r\n\r\n    this.defaultPosition = new Vector3(0, 0, -3000);\r\n    this.defaultRotation = new Euler(0, Math.PI, 0);\r\n\r\n    this.camera.position.copy(this.defaultPosition);\r\n    this.camera.rotation.copy(this.defaultRotation);\r\n\r\n    this.transitionInfo = {\r\n      targetPosition: null,\r\n      targetRotation: null,\r\n    };\r\n\r\n    this.positionTween = null;\r\n    this.rotationTween = null;\r\n  }\r\n\r\n  goToOverview() {\r\n    this.transition(this.defaultPosition, this.defaultRotation);\r\n  }\r\n\r\n  goToSurface(surface) {\r\n    if (surface === null) {\r\n      this.goToOverview();\r\n      return;\r\n    }\r\n\r\n    this.camera.up.copy(surface.mesh.up);\r\n\r\n    // padding is empty space in pixels (on screen) above and below the surface\r\n    const padding = 100;\r\n    const fov = _Math.degToRad(this.camera.fov);\r\n    const q = 2 * padding / window.innerHeight;\r\n    const dist = (surface.height / (1 - q)) / (2 * Math.tan(fov / 2));\r\n\r\n    const worldPosition = new Vector3();\r\n    surface.mesh.getWorldPosition(worldPosition);\r\n\r\n    const targetPosition = new Vector3();\r\n    surface.mesh.getWorldDirection(targetPosition);\r\n    targetPosition.multiplyScalar(dist);\r\n    targetPosition.add(worldPosition);\r\n\r\n    const startPosition = this.camera.position.clone();\r\n    const startRotation = this.camera.rotation.clone();\r\n\r\n    this.camera.position.copy(targetPosition);\r\n    this.camera.lookAt(worldPosition);\r\n    const targetRotation = this.camera.rotation.clone();\r\n\r\n    this.camera.position.copy(startPosition);\r\n    this.camera.rotation.copy(startRotation);\r\n\r\n    this.transition(targetPosition, targetRotation)\r\n  }\r\n\r\n  transition(targetPosition, targetRotation) {\r\n    this.transitionInfo = {\r\n      targetPosition,\r\n      targetRotation\r\n    };\r\n\r\n    // TWEEN\r\n    const duration = 800;\r\n\r\n    this.positionTween = new Tween(this.camera.position).easing(Easing.Cubic.Out).to({\r\n      x: targetPosition.x,\r\n      y: targetPosition.y,\r\n      z: targetPosition.z\r\n    }, duration).start();\r\n\r\n    // NOTE: there's also nlerp (for performance maybe?)\r\n    // http://number-none.com/product/Understanding%20Slerp,%20Then%20Not%20Using%20It/\r\n    const startQuaternion = new Quaternion();\r\n    startQuaternion.setFromEuler(this.camera.rotation);\r\n    const endQuaternion = new Quaternion();\r\n    endQuaternion.setFromEuler(targetRotation);\r\n    let q = new Quaternion();\r\n    this.rotationTween = new Tween({t: 0}).to({t: 1}, duration).easing(Easing.Cubic.Out).on('update', ({t}) =>{\r\n      Quaternion.slerp(startQuaternion, endQuaternion, q, t);\r\n      this.camera.quaternion.copy(q);\r\n    }).start();\r\n  }\r\n\r\n  isTransitionRunning() {\r\n    if (this.positionTween === null || this.rotationTween === null) return false;\r\n    return this.positionTween.isPlaying() || this.rotationTween.isPlaying();\r\n  }\r\n\r\n  // returns [position, rotation]\r\n  toCamera(surface) {\r\n    const cameraOriginalPosition = this.camera.position.clone();\r\n    const cameraOriginalRotation = this.camera.rotation.clone();\r\n    let transition = this.isTransitionRunning(); // In the TINY chance that running changes while this function is running, store its value here and use that instead.\r\n    if (transition) {\r\n      this.camera.position.copy(this.transitionInfo.targetPosition);\r\n      this.camera.rotation.copy(this.transitionInfo.targetRotation);\r\n    }\r\n\r\n    // padding is empty space in pixels (on screen) above and below the surface\r\n    const padding = 80;\r\n    const fov = _Math.degToRad(this.camera.fov);\r\n    const q = 2 * padding / window.innerHeight;\r\n    const dist = (surface.height / (1 - q)) / (2 * Math.tan(fov / 2));\r\n\r\n    const worldPosition = new Vector3();\r\n    this.camera.getWorldPosition(worldPosition);\r\n\r\n    const targetPosition = new Vector3();\r\n    this.camera.getWorldDirection(targetPosition);\r\n    targetPosition.multiplyScalar(dist);\r\n    targetPosition.add(worldPosition);\r\n\r\n    const startPosition = surface.mesh.position.clone();\r\n    const startRotation = surface.mesh.rotation.clone();\r\n\r\n    surface.mesh.position.copy(targetPosition);\r\n    surface.mesh.lookAt(worldPosition);\r\n    const targetRotation = surface.mesh.rotation.clone();\r\n\r\n    surface.mesh.position.copy(startPosition);\r\n    surface.mesh.rotation.copy(startRotation);\r\n\r\n    if (transition) {\r\n      this.camera.position.copy(cameraOriginalPosition);\r\n      this.camera.rotation.copy(cameraOriginalRotation);\r\n    }\r\n    return [targetPosition, targetRotation];\r\n  }\r\n}","import { Scene, DoubleSide, BoxGeometry, MeshPhongMaterial, Mesh, PointLight, WebGLRenderer } from 'three';\r\nimport { CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport debounce from 'lodash.debounce';\r\nimport { update } from 'es6-tween';\r\nimport SCCamera from './SCCamera.js';\r\nimport roomGLB from './assets/glb/room2.glb';\r\n\r\nexport const scCamera = new SCCamera();\r\nconst glScene = new Scene();\r\nconst bgScene = new Scene();\r\nconst cssScene = new Scene();\r\nexport const surfaceDeps = { glScene, cssScene, camera: scCamera };\r\n\r\n// cube\r\nconst geometry = new BoxGeometry(200, 200, 200);\r\nconst material = new MeshPhongMaterial({\r\n  color: 0xff0000,\r\n  emissive: 0x000000,\r\n  specular: 0x111111,\r\n  side: DoubleSide,\r\n  flatShading: false,\r\n  shininess: 30\r\n});\r\nconst cube = new Mesh(geometry, material);\r\ncube.position.z = -250;\r\ncube.position.x = 250;\r\ncube.position.y = 250;\r\nglScene.add(cube);\r\n\r\nconst cubeShadow = new Mesh(geometry, material.clone());\r\ncubeShadow.castShadow = true;\r\ncubeShadow.material.transparent = true;\r\ncubeShadow.material.opacity = 0;\r\ncubeShadow.position.copy(cube.position);\r\nbgScene.add(cubeShadow);\r\n\r\nconst loader = new GLTFLoader();\r\n/*loader.load(roomGLB, function (gltf) {\r\n  gltf.scene.scale.multiplyScalar(100);\r\n  gltf.scene.rotation.y = Math.PI;\r\n  gltf.scene.position.y = -500;\r\n  gltf.scene.position.z = -500;\r\n  gltf.scene.children[0].receiveShadow = true;\r\n  bgScene.add(gltf.scene);\r\n});*/\r\n\r\nloader.load(roomGLB, function (gltf) {\r\n  gltf.scene.scale.multiplyScalar(100);\r\n  gltf.scene.rotation.y = Math.PI;\r\n  gltf.scene.position.y = -550;\r\n  gltf.scene.position.z = -500;\r\n  gltf.scene.position.x = -2280;\r\n  gltf.scene.children[0].receiveShadow = true;\r\n  bgScene.add(gltf.scene);\r\n});\r\n\r\n// light\r\nconst pointLight = new PointLight(0xffffff, 0.8, 0, 2);\r\npointLight.castShadow = true;\r\npointLight.position.z = -1000;\r\npointLight.shadow.mapSize.width = 2048;  // default\r\npointLight.shadow.mapSize.height = 2048; // default\r\npointLight.shadow.camera.near = 0.5;       // default\r\npointLight.shadow.camera.far = 5000      // default\r\nglScene.add(pointLight);\r\nbgScene.add(new PointLight().copy(pointLight));\r\n//const sphereSize = 100;\r\n//const pointLightHelper = new PointLightHelper( pointLight, sphereSize );\r\n//glScene.add( pointLightHelper );\r\n\r\n\r\n\r\nconst bgRenderer = new WebGLRenderer({ alpha: true });\r\nbgRenderer.setClearColor(0x000000, 0);\r\nbgRenderer.setPixelRatio(window.devicePixelRatio);\r\nbgRenderer.setSize(window.innerWidth, window.innerHeight);\r\nbgRenderer.domElement.style.position = 'absolute';\r\nbgRenderer.domElement.style.top = 0;\r\nbgRenderer.domElement.style.left = 0;\r\nbgRenderer.shadowMap.enabled = true;\r\ndocument.getElementById('canvas').appendChild(bgRenderer.domElement);\r\n\r\nconst cssRenderer = new CSS3DRenderer();\r\ncssRenderer.setSize(window.innerWidth, window.innerHeight);\r\ncssRenderer.domElement.style.position = 'absolute';\r\ncssRenderer.domElement.style.top = 0;\r\ncssRenderer.domElement.style.left = 0;\r\ndocument.getElementById('canvas').appendChild(cssRenderer.domElement);\r\n\r\nconst glRenderer = new WebGLRenderer({ alpha: true });\r\nglRenderer.setClearColor(0x000000, 0);\r\nglRenderer.setPixelRatio(window.devicePixelRatio);\r\nglRenderer.setSize(window.innerWidth, window.innerHeight);\r\nglRenderer.domElement.style.position = 'absolute';\r\nglRenderer.domElement.style.top = 0;\r\nglRenderer.domElement.style.left = 0;\r\nglRenderer.domElement.style.pointerEvents = 'none';\r\ndocument.getElementById('canvas').appendChild(glRenderer.domElement);\r\n\r\nconst onResize = debounce(() => {\r\n  scCamera.camera.aspect = window.innerWidth / window.innerHeight;\r\n  scCamera.camera.updateProjectionMatrix();\r\n  bgRenderer.setSize(window.innerWidth, window.innerHeight);\r\n  cssRenderer.setSize(window.innerWidth, window.innerHeight);\r\n  glRenderer.setSize(window.innerWidth, window.innerHeight);\r\n}, 100);\r\nwindow.addEventListener('resize', onResize);\r\n\r\nexport const refresh = () => {\r\n  bgRenderer.render(bgScene, scCamera.camera);\r\n  cssRenderer.render(cssScene, scCamera.camera);\r\n  glRenderer.render(glScene, scCamera.camera);\r\n};\r\n\r\nconst animate = (time) => {\r\n  requestAnimationFrame(animate);\r\n\r\n  cube.rotation.x += 0.01;\r\n  cubeShadow.rotation.x += 0.01;\r\n  cube.rotation.y += 0.01;\r\n  cubeShadow.rotation.y += 0.01;\r\n  bgRenderer.render(bgScene, scCamera.camera);\r\n  cssRenderer.render(cssScene, scCamera.camera);\r\n  glRenderer.render(glScene, scCamera.camera);\r\n  update(time);\r\n};\r\n\r\nanimate();\r\n","import { MeshBasicMaterial, DoubleSide, PlaneBufferGeometry, Mesh, NoBlending, Quaternion } from 'three';\r\nimport { CSS3DObject } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\r\nimport { Tween, Easing } from 'es6-tween';\r\nimport { refresh } from '../render';\r\nimport './Surface.css';\r\n\r\nconst material = new MeshBasicMaterial({\r\n  opacity: 0,\r\n  color: 0x000000,\r\n  side: DoubleSide,\r\n  blending: NoBlending\r\n});\r\n\r\nexport default class SurfaceData {\r\n  constructor(...args) {\r\n    this.initialize(...args);\r\n  }\r\n\r\n  initialize({ width, height, position, rotation, up, glScene, cssScene, camera, isClickable = true, resolutionScale = 1, parent = null }) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.resolutionScale = resolutionScale;\r\n    this.originalPosition = position.clone();\r\n    this.originalRotation = rotation.clone();\r\n    this.originalUp = up.clone();\r\n    this.atOriginalPosition = true;\r\n\r\n    this.parent = parent;\r\n    this.camera = camera;\r\n\r\n    this.element = document.createElement('div');\r\n    this.element.style.width = `${width * this.resolutionScale}px`;\r\n    this.element.style.height = `${height * this.resolutionScale}px`;\r\n    this.element.style.opacity = 1;\r\n\r\n    this.object = new CSS3DObject(this.element);\r\n    this.object.position.copy(position);\r\n    this.object.rotation.copy(rotation);\r\n    this.object.scale.set(1 / this.resolutionScale, 1 / this.resolutionScale, 1 / this.resolutionScale);\r\n\r\n    this.geometry = new PlaneBufferGeometry(width, height);\r\n    this.mesh = new Mesh(this.geometry, material);\r\n    this.mesh.position.copy(position);\r\n    this.mesh.rotation.copy(rotation);\r\n    this.mesh.up = up;\r\n    this.mesh.castShadow = false;\r\n    this.mesh.receiveShadow = true;\r\n\r\n    // if we don't refresh here, there's no guarantee the surface exists in the DOM once we start doing stuff with it!\r\n    glScene.add(this.mesh);\r\n    cssScene.add(this.object);\r\n    refresh();\r\n  \r\n    // put this here (as opposed to its own class member) so we can borrow the scenes.\r\n    this.destroy = () => {\r\n      glScene.remove(this.mesh);\r\n      cssScene.remove(this.object);\r\n      refresh();\r\n    };\r\n  }\r\n\r\n  updateLayout(position, rotation, up) {\r\n    this.originalPosition = position.clone();\r\n    this.originalRotation = rotation.clone();\r\n    this.originalUp = up.clone();\r\n\r\n    this.object.position.copy(position);\r\n    this.object.rotation.copy(rotation);\r\n    this.mesh.position.copy(position);\r\n    this.mesh.rotation.copy(rotation);\r\n    this.mesh.up = up;\r\n  }\r\n\r\n  moveToCamera() {\r\n    const [position, rotation] = this.camera.toCamera(this);\r\n    if (this.mesh.position.manhattanDistanceTo(position) < Number.EPSILON) return;\r\n    \r\n    this.moveTransition(position, rotation);\r\n    this.atOriginalPosition = false;\r\n  }\r\n\r\n  moveToOriginal() {\r\n    if (this.mesh.position.manhattanDistanceTo(this.originalPosition) < Number.EPSILON) return;\r\n\r\n    this.moveTransition(this.originalPosition, this.originalRotation);\r\n    this.atOriginalPosition = true;\r\n  }\r\n\r\n  moveToggle() {\r\n    if (this.atOriginalPosition) this.moveToCamera();\r\n    else this.moveToOriginal();\r\n  }\r\n\r\n  moveTransition(targetPosition, targetRotation) {\r\n    // TWEEN\r\n    const duration = 200;\r\n\r\n    new Tween(this.object.position).easing(Easing.Cubic.Out).to({\r\n      x: targetPosition.x,\r\n      y: targetPosition.y,\r\n      z: targetPosition.z\r\n    }, duration).start();\r\n    new Tween(this.mesh.position).easing(Easing.Cubic.Out).to({\r\n      x: targetPosition.x,\r\n      y: targetPosition.y,\r\n      z: targetPosition.z\r\n    }, duration).start();\r\n\r\n    // NOTE: there's also nlerp (for performance maybe?)\r\n    // http://number-none.com/product/Understanding%20Slerp,%20Then%20Not%20Using%20It/\r\n    const startQuaternion = new Quaternion();\r\n    startQuaternion.setFromEuler(this.mesh.rotation);\r\n    const endQuaternion = new Quaternion();\r\n    endQuaternion.setFromEuler(targetRotation);\r\n    let q = new Quaternion();\r\n    new Tween({t: 0}).to({t: 1}, duration).easing(Easing.Cubic.Out).on('update', ({t}) =>{\r\n      Quaternion.slerp(startQuaternion, endQuaternion, q, t);\r\n      this.mesh.quaternion.copy(q);\r\n      this.object.quaternion.copy(q);\r\n    }).start();\r\n  }\r\n}","import React, { useRef, cloneElement, useEffect, useCallback } from 'react';\r\nimport { Vector3, Euler, Scene } from 'three';\r\nimport { createPortal } from 'react-dom';\r\nimport PropTypes from 'prop-types';\r\nimport SurfaceData from './SurfaceData';\r\nimport SCCamera from '../SCCamera';\r\nimport './Surface.css';\r\n\r\nfunction Surface(props) {\r\n  // https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\r\n  const surfaceData = useRef(null);\r\n\r\n  // this is only a useCallback hook because the linter said to make it so, apparently it can cause unnecessary re-renders in the useEffect hook below otherwise\r\n  const getSurfaceData = useCallback(\r\n    () => {\r\n      if (surfaceData.current !== null) return surfaceData.current;\r\n      surfaceData.current = new SurfaceData(props);\r\n      return surfaceData.current;\r\n    },\r\n    [props]\r\n  );\r\n\r\n  // if we get new layout props, update the 3d surface\r\n  useEffect(() => {\r\n    getSurfaceData().updateLayout(props.position, props.rotation, props.up);\r\n  }, [getSurfaceData, props.position, props.rotation, props.up])\r\n\r\n  // remove surface when destroying the component\r\n  useEffect(() => {\r\n    return () => {\r\n      surfaceData.current.destroy();\r\n    };\r\n  }, []);\r\n\r\n  return createPortal((\r\n    <div className=\"surface\" style={{ fontSize: `${10 * getSurfaceData().resolutionScale}px` }}>\r\n      {cloneElement(props.children, { surface: getSurfaceData() })}\r\n    </div>\r\n  ), getSurfaceData().element);\r\n}\r\n\r\n// make sure this matches the args in SurfaceData.js\r\nSurface.propTypes = {\r\n  width: PropTypes.number.isRequired, \r\n  height: PropTypes.number.isRequired,\r\n  position: PropTypes.instanceOf(Vector3).isRequired,\r\n  rotation: PropTypes.instanceOf(Euler).isRequired,\r\n  up: PropTypes.instanceOf(Vector3).isRequired, \r\n  glScene: PropTypes.instanceOf(Scene).isRequired, \r\n  cssScene: PropTypes.instanceOf(Scene).isRequired, \r\n  camera: PropTypes.instanceOf(SCCamera).isRequired, \r\n  isClickable: PropTypes.bool, \r\n  resolutionScale: PropTypes.number, \r\n  parent: PropTypes.instanceOf(SurfaceData),\r\n  children: PropTypes.element.isRequired\r\n};\r\n\r\nexport default Surface;","import { createContext } from 'react';\r\n\r\nconst CameraContext = createContext({\r\n  cameraView: null,\r\n  setCameraView: null\r\n});\r\n\r\nexport default CameraContext;\r\n","import React, { useContext, Fragment } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport CameraContext from '../CameraContext';\r\n\r\nexport default function withMainSurface(Component) {\r\n  function MainSurface(props) {\r\n    const { cameraView, setCameraView } = useContext(CameraContext);\r\n\r\n    const isCameraHere = cameraView === props.surface;\r\n    const isCameraOverview = cameraView === null;\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className={`surface__content ${!isCameraHere ? 'surface__content--no-pointer' : ''}`}>\r\n          <Component {...props} />\r\n        </div>\r\n        <div\r\n          className={`surface__overlay ${!isCameraOverview ? 'surface__overlay--hidden' : ''}`}\r\n          onClick={() => setCameraView(props.surface)}\r\n        />\r\n      </Fragment>\r\n    );\r\n  };\r\n\r\n  MainSurface.propTypes = {\r\n    surface: PropTypes.object\r\n  };\r\n\r\n  return MainSurface;\r\n}\r\n","import React, { useState, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport withMainSurface from './Surface/withMainSurface';\r\nimport CameraContext from './CameraContext';\r\nimport './Test.css';\r\n\r\nfunction Test(props) {\r\n  const [test, setTest] = useState(0);\r\n  const { cameraView } = useContext(CameraContext);\r\n\r\n  const isCameraHere = cameraView === props.surface;\r\n\r\n  return (\r\n    <div className=\"test\">\r\n      <h1>Hello World</h1>\r\n      <p>{test}</p>\r\n        {isCameraHere &&\r\n          <h3>Camera is here</h3>\r\n        }\r\n      <button onClick={() => setTest(test + 1)}>Click me</button>\r\n    </div>\r\n  );\r\n}\r\n\r\nTest.propTypes = {\r\n  surface: PropTypes.object.isRequired\r\n};\r\n\r\nexport default withMainSurface(Test);\r\n","import { useState, useLayoutEffect } from 'react';\r\nimport { Vector3 } from 'three';\r\n\r\n// recursively check offset to determine position (in pixels) of the anchor relative to surface.\r\n// returns null if surface isn't found\r\nfunction offset(element) {\r\n  if (element.offsetParent === null) return { left: 0, top: 0};\r\n  if (element.className === 'surface') return { left: 0, top: 0};\r\n  const offsetParentOffset = offset(element.offsetParent);\r\n  return {\r\n    left: offsetParentOffset.left + element.offsetLeft, \r\n    top: offsetParentOffset.top + element.offsetTop\r\n  };\r\n}\r\n\r\nexport default function useGetAnchorData(surface, anchorRef, causeUpdate) {\r\n  const [anchorData, setAnchorData] = useState(null);\r\n\r\n  useLayoutEffect(() => {\r\n    // top-left corner has index := 0\r\n    const vertices = surface.geometry.getAttribute('position');\r\n    const i = 0;\r\n    const topLeft = surface.mesh.localToWorld(new Vector3(vertices.getX(i), vertices.getY(i), vertices.getZ(i)))\r\n\r\n    const origin = new Vector3();\r\n    surface.mesh.getWorldPosition(origin);\r\n    const rightDirection = new Vector3().subVectors(surface.mesh.localToWorld(new Vector3(1, 0, 0)), origin);\r\n    const downDirection = new Vector3().subVectors(surface.mesh.localToWorld(new Vector3(0, -1, 0)), origin);\r\n    const outDirection = new Vector3();\r\n    surface.mesh.getWorldDirection(outDirection);\r\n\r\n    rightDirection.normalize();\r\n    downDirection.normalize();\r\n    outDirection.normalize();\r\n    const anchorOffset = offset(anchorRef.current);\r\n    anchorOffset.left += anchorRef.current.offsetWidth / 2;\r\n    anchorOffset.top += anchorRef.current.offsetHeight / 2;\r\n    anchorOffset.left /= surface.resolutionScale;\r\n    anchorOffset.top /= surface.resolutionScale;\r\n\r\n    const position = topLeft.clone();\r\n    position.addScaledVector(rightDirection, anchorOffset.left)\r\n      .addScaledVector(downDirection, anchorOffset.top)\r\n      .addScaledVector(outDirection, 10);\r\n\r\n    setAnchorData({\r\n      position,\r\n      rotation: surface.mesh.rotation.clone(),\r\n      up: surface.mesh.up.clone()\r\n    });\r\n  }, [surface, anchorRef, causeUpdate]);\r\n\r\n  return anchorData;\r\n}\r\n\r\n","import React, { useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Surface from './';\r\nimport SurfaceData from './SurfaceData';\r\nimport useGetAnchorData from './useGetAnchorData';\r\n\r\nfunction AnchoredSurface(props) {\r\n  const anchorRef = useRef(null);\r\n  const anchorData = useGetAnchorData(props.parent, anchorRef, props.causeUpdate);\r\n\r\n  return (\r\n    <div\r\n      className=\"anchor\"\r\n      ref={anchorRef}\r\n      style={{\r\n        width: props.width * props.parent.resolutionScale,\r\n        height: props.height * props.parent.resolutionScale\r\n      }}\r\n    >\r\n      {anchorData &&\r\n        <Surface\r\n          position={anchorData.position}\r\n          rotation={anchorData.rotation}\r\n          up={anchorData.up}\r\n          {...props}\r\n        >\r\n          {props.children}\r\n        </Surface>\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nAnchoredSurface.propTypes = {\r\n  width: PropTypes.number.isRequired,\r\n  height: PropTypes.number.isRequired,\r\n  parent: PropTypes.instanceOf(SurfaceData).isRequired,\r\n  children: PropTypes.element.isRequired,\r\n  causeUpdate: PropTypes.number, // just a number, if it changes, update surface to anchor position\r\n}\r\n\r\nexport default AnchoredSurface;\r\n","import React, { useContext, useEffect, Fragment } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport CameraContext from '../CameraContext';\r\n\r\nconst isCameraParent = (cameraView, parent) => {\r\n  if (parent === null) return false;\r\n  if (cameraView === parent) return true;\r\n  return isCameraParent(cameraView, parent.parent);\r\n};\r\n\r\nexport default function withSubSurface(Component) {\r\n  function SubSurface(props) {\r\n    const { cameraView } = useContext(CameraContext);\r\n\r\n    // if surface has a parent and the camera is not on that parent, disable pointer events\r\n    useEffect(() => {\r\n      if (isCameraParent(cameraView, props.surface.parent)) {\r\n        props.surface.object.element.className = \"\";\r\n      } else {\r\n        props.surface.object.element.className = \"pointer-events-none\";\r\n      }\r\n    }, [cameraView, props.surface]);\r\n\r\n    // when going back to overview, ensure that the surface goes back to its original position.\r\n    useEffect(() => {\r\n      if (cameraView !== null) return;\r\n      props.surface.moveToOriginal();\r\n    }, [cameraView, props.surface]);\r\n\r\n    return (\r\n      <Fragment>\r\n        <div className=\"surface__content\">\r\n          <Component {...props} />\r\n        </div>\r\n        <div\r\n          className={`surface__overlay ${!isCameraParent(cameraView, props.surface.parent) ? 'surface__overlay--hidden' : ''}`}\r\n          onClick={() => props.surface.moveToggle()}\r\n        />\r\n      </Fragment>\r\n    );\r\n  };\r\n\r\n  SubSurface.propTypes = {\r\n    surface: PropTypes.object\r\n  };\r\n\r\n  return SubSurface;\r\n}\r\n","import React from 'react';\r\nimport withSubSurface from '../Surface/withSubSurface';\r\nimport './Pamphlet.css';\r\n\r\nfunction Pamphlet(props) {\r\n  return (\r\n    <div className=\"pamphlet\">\r\n      Hej\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withSubSurface(Pamphlet);\r\n","import React, { Fragment, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport AnchoredSurface from '../Surface/AnchoredSurface.jsx';\r\nimport Pamphlet from './Pamphlet';\r\nimport withMainSurface from '../Surface/withMainSurface';\r\nimport { surfaceDeps } from '../render';\r\nimport './Board.css';\r\n\r\nfunction Board(props) {\r\n  const [extraSurfaces, setExtraSurfaces] = useState([]);\r\n\r\n  const extras = (\r\n    <Fragment>\r\n      {extraSurfaces.map((surfaceProps, i) => \r\n        <AnchoredSurface key={i} {...surfaceProps} causeUpdate={extraSurfaces.length}>\r\n          <Pamphlet />\r\n        </AnchoredSurface>\r\n      )}\r\n    </Fragment>\r\n  );\r\n\r\n  return (\r\n    <div className=\"board\">\r\n      <div className=\"board__content\">\r\n        <div className=\"board__buttons\">\r\n          <button\r\n            onClick={() => setExtraSurfaces([...extraSurfaces, {\r\n              width: 100,\r\n              height: 150,\r\n              parent: props.surface,\r\n              resolutionScale: 2,\r\n              ...surfaceDeps\r\n            }])}\r\n          >\r\n            +\r\n          </button>\r\n          <button\r\n            disabled={extraSurfaces.length === 0}\r\n            onClick={() => setExtraSurfaces(extraSurfaces.slice(0, -1))}\r\n          >\r\n            -\r\n          </button>\r\n        </div>\r\n        <div className=\"board__pamphlets\">\r\n          <AnchoredSurface\r\n            width={100}\r\n            height={150}\r\n            parent={props.surface}\r\n            resolutionScale={5}\r\n            causeUpdate={extraSurfaces.length}\r\n            {...surfaceDeps}\r\n          >\r\n            <Pamphlet />\r\n          </AnchoredSurface>\r\n          <AnchoredSurface\r\n            width={100}\r\n            height={150}\r\n            parent={props.surface}\r\n            resolutionScale={2}\r\n            causeUpdate={extraSurfaces.length}\r\n            {...surfaceDeps}\r\n          >\r\n            <Pamphlet />\r\n          </AnchoredSurface>\r\n          <AnchoredSurface\r\n            width={100}\r\n            height={150}\r\n            parent={props.surface}\r\n            resolutionScale={1}\r\n            causeUpdate={extraSurfaces.length}\r\n            {...surfaceDeps}\r\n          >\r\n            <Pamphlet />\r\n          </AnchoredSurface>\r\n\r\n          {extras}\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nBoard.propTypes = {\r\n  surface: PropTypes.object.isRequired\r\n};\r\n\r\nexport default withMainSurface(Board);\r\n","import { scaleThreshold } from 'd3';\r\n\r\n// http://airindex.eea.europa.eu/\r\nexport const EAQI_COLORS = {\r\n  good: [80, 240, 230, 255],\r\n  fair: [80, 204, 170, 255],\r\n  moderate: [240, 230, 65, 255],\r\n  poor: [255, 80, 80, 255],\r\n  veryPoor: [150, 0, 50, 255]\r\n}\r\n\r\nexport const EAQI_COLOR_RANGE = [\r\n  EAQI_COLORS.good,\r\n  EAQI_COLORS.fair,\r\n  EAQI_COLORS.moderate,\r\n  EAQI_COLORS.poor,\r\n  EAQI_COLORS.veryPoor\r\n];\r\n\r\nexport const EAQI_PM2_5_DOMAIN = [10, 20, 25, 50];\r\nexport const EAQI_PM10_DOMAIN = [20, 35, 50, 100];\r\n\r\nexport const EAQI_PM2_5_LABELS = [0, 10, 20, 25, 50, '∞'];\r\nexport const EAQI_PM10_LABELS = [0, 20, 35, 50, 100, '∞'];\r\n\r\nexport const pm2_5ColorScale = scaleThreshold()\r\n    .domain(EAQI_PM2_5_DOMAIN)\r\n    .range(EAQI_COLOR_RANGE);\r\n\r\nexport const pm10ColorScale = scaleThreshold()\r\n    .domain(EAQI_PM10_DOMAIN)\r\n    .range(EAQI_COLOR_RANGE);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { BaseControl } from 'react-map-gl';\r\nimport './Legend.css';\r\n\r\nfunction colorArrayToRgb(color) {\r\n  return `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3] / 255})`\r\n}\r\n\r\nconst width = 250;\r\nconst height = 30;\r\nconst margin = 10;\r\n\r\n// TODO: unit, fix margins and numbers and shit, right now it's a bit too hardcoded\r\nclass Legend extends BaseControl {\r\n  _render() {\r\n    const { title, unit, colors, labels } = this.props;\r\n\r\n    if (colors.length !== labels.length - 1)\r\n      throw new Error(\"With N colors, there must be N+1 labels.\");\r\n\r\n    const rectWidth = width / colors.length;\r\n    const colorRects = colors.map((color, i) => (\r\n      <rect width={rectWidth} height={height} x={rectWidth * i} fill={colorArrayToRgb(colors[i])} key={i} />\r\n    ));\r\n\r\n    const labelTexts = labels.map((label, i) => (\r\n      <text x={rectWidth * i} dy=\"1.2em\" textAnchor=\"middle\" key={i}>{label}</text>\r\n    ));\r\n\r\n    return (\r\n      <div className=\"map-legend\">\r\n        <svg width={width + margin * 2} height={height + margin * 2 + 20}>\r\n          <g transform={`translate(${margin} ${margin})`}>\r\n            <g>\r\n              <text x={width / 2} dy=\"5\" textAnchor=\"middle\" className=\"map-legend__title\">{title}</text>\r\n            </g>\r\n            <g transform={`translate(0 10)`}>\r\n              {colorRects}\r\n            </g>\r\n            <g transform={`translate(0 ${height + 10})`}>\r\n              {labelTexts}\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nLegend.propTypes = {\r\n  title: PropTypes.string.isRequired,\r\n  unit: PropTypes.string,\r\n  colors: PropTypes.array.isRequired,\r\n  labels: PropTypes.array.isRequired,\r\n}\r\n\r\nexport default Legend;\r\n","/**\r\n * Goal of this function is to restructure the LuftData API JSON object so that it is an array of locations,\r\n * rather than an array of measurements. Another goal is also to calculate the average measurements.\r\n * The API will return all measurements taken in the previous 5 minutes, and they can vary quite a bit,\r\n * so because we only want to show 1 value, the average is calculated and can then be used in maps, visualizations etc.\r\n *\r\n * Finally, some structure changes are motivated by what data is expected from deck.gl layers, e.g. the position prop.\r\n */\r\nfunction processLuftData(jsonArray) {\r\n  // use an object to speed this up a bit\r\n  const locationsObj = jsonArray.reduce((locations, row) => {\r\n    const { location, sensor, ...measurement } = row;\r\n    if (!locations.hasOwnProperty(location.id))\r\n      locations[location.id] = {\r\n        sensors: {},\r\n        average_measurements: null,\r\n        position: [parseFloat(location.longitude), parseFloat(location.latitude), parseFloat(location.altitude)]\r\n      };\r\n\r\n    if (!locations[location.id].sensors.hasOwnProperty(sensor.id))\r\n      locations[location.id].sensors[sensor.id] = { ...sensor, measurements: [] };\r\n    locations[location.id].sensors[sensor.id].measurements.push({ ...measurement });\r\n\r\n    return locations;\r\n  }, {});\r\n\r\n  // now that we got the data per location, make it into an array again (instead of an object), also calculate averages\r\n  return Object.keys(locationsObj).map(locationId => {\r\n    const location = locationsObj[locationId];\r\n    location.sensors = Object.keys(location.sensors).map(sensorId => location.sensors[sensorId]);\r\n\r\n    // calc averages\r\n    const measurementSums = location.sensors.reduce((sumObj, sensor) => {\r\n      sensor.measurements.forEach(measurement => {\r\n        measurement.sensordatavalues.forEach(valueObj => {\r\n          if(!sumObj.hasOwnProperty(valueObj.value_type))\r\n            sumObj[valueObj.value_type] = { sum: 0, count: 0 };\r\n\r\n          sumObj[valueObj.value_type].sum += parseFloat(valueObj.value);\r\n          sumObj[valueObj.value_type].count += 1;\r\n        });\r\n      });\r\n      return sumObj;\r\n    }, {});\r\n\r\n    location.average_measurements = Object.keys(measurementSums).reduce((acc, value_type) => ({\r\n        ...acc,\r\n        [value_type]: measurementSums[value_type].sum / measurementSums[value_type].count\r\n    }), {});\r\n\r\n    return location;\r\n  });\r\n\r\n}\r\n\r\nexport default processLuftData;\r\n","import React, { useState } from 'react';\r\nimport { StaticMap, NavigationControl } from 'react-map-gl';\r\nimport DeckGL from '@deck.gl/react';\r\nimport { ScatterplotLayer } from '@deck.gl/layers';\r\nimport { EAQI_COLOR_RANGE, EAQI_PM10_LABELS, pm10ColorScale } from './scales';\r\nimport Legend from './Legend';\r\nimport withMainSurface from '../Surface/withMainSurface';\r\nimport processLuftData from './processLuftData';\r\nimport tempData from './tempData.json';\r\nimport 'mapbox-gl/dist/mapbox-gl.css';\r\n\r\n// tempData.json was retrieved from the following url:\r\n// http://api.luftdaten.info/v1/filter/area=59.305477,18.105203,0.50\r\n// the goal eventually (once the map layers work) is to retrieve it continuously from the API, since it's real time data. \r\nconst data = processLuftData(tempData);\r\nconsole.log(data);\r\n\r\nfunction Map() {\r\n  const [viewport, setViewport] = useState({\r\n    latitude: 59.305477, \r\n    longitude: 18.105203,\r\n    zoom: 15,\r\n    bearing: 0,\r\n    pitch: 0,\r\n    width: 1000,\r\n    height: 1000\r\n  });\r\n\r\n  const layers = [\r\n    new ScatterplotLayer({\r\n      id: 'particles-layer',\r\n      data,\r\n      lineWidthUnits: 'pixels',\r\n      getRadius: 30,\r\n      getFillColor: d => pm10ColorScale(d.average_measurements.P1),\r\n      getLineColor: [0, 0, 0, 255],\r\n      getLineWidth: 10\r\n    })\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      <DeckGL\r\n        viewState={viewport}\r\n        onViewStateChange={({ viewState }) => setViewport(viewState)}\r\n        layers={layers}\r\n        controller={true}\r\n      >\r\n        <StaticMap\r\n          mapStyle='http://localhost:8080/styles/klokantech-basic/style.json' // obviously temporary, running \"TileServer GL\" locally, mapquest billing makes me nervous\r\n        >\r\n          <div className='mapboxgl-ctrl-bottom-right'>\r\n            <NavigationControl \r\n              onViewportChange={(viewState) => setViewport(viewState)}\r\n            />\r\n          </div>\r\n\r\n          <div className='mapboxgl-ctrl-bottom-left'>\r\n            <Legend\r\n              title=\"PM10\"\r\n              colors={EAQI_COLOR_RANGE}\r\n              labels={EAQI_PM10_LABELS}\r\n            />\r\n          </div>\r\n        </StaticMap>\r\n      </DeckGL>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withMainSurface(Map);\r\n","import React, { useState, useEffect, Fragment } from \"react\";\nimport { Vector3, Euler } from \"three\";\nimport { Helmet } from \"react-helmet\";\nimport Embed from \"react-embed\";\nimport Surface from \"./Surface\";\nimport Test from \"./Test.jsx\";\nimport Board from \"./Board\";\nimport MapTest from \"./Map\";\nimport { scCamera, surfaceDeps } from \"./render\";\nimport withMainSurface from \"./Surface/withMainSurface\";\nimport CameraContext from \"./CameraContext\";\nimport \"./App.css\";\n\nconst farLeftWallProps = {\n  width: 1000,\n  height: 1000,\n  position: new Vector3(1620, 0, -940),\n  rotation: new Euler(0, -2 * Math.PI / 3, 0),\n  up: new Vector3(0, 1, 0),\n  ...surfaceDeps\n};\nconst middleLeftWallProps = {\n  width: 1000,\n  height: 1000,\n  position: new Vector3(935, 0, -265),\n  rotation: new Euler(0, -5 * Math.PI / 6, 0),\n  up: new Vector3(0, 1, 0),\n  ...surfaceDeps\n};\nconst backWallProps = {\n  width: 1000,\n  height: 1000,\n  position: new Vector3(0, 0, -20),\n  rotation: new Euler(0, Math.PI, 0),\n  up: new Vector3(0, 1, 0),\n  ...surfaceDeps\n};\nconst middleRightWallProps = {\n  width: 1000,\n  height: 1000,\n  position: new Vector3(-930, 0, -270),\n  rotation: new Euler(0, 5 * Math.PI / 6, 0),\n  up: new Vector3(0, 1, 0),\n  ...surfaceDeps\n};\nconst farRightWallProps = {\n  width: 1000,\n  height: 1000,\n  position: new Vector3(-1620, 0, -940),\n  rotation: new Euler(0, 2 * Math.PI / 3, 0),\n  up: new Vector3(0, 1, 0),\n  ...surfaceDeps\n};\n\nconst Embedded = withMainSurface(() => {\n  return (\n    <div className=\"embedded\">\n      <div id=\"customize-script-container\"></div>\n      <Embed url=\"https://www.youtube.com/watch?v=soICQ3B2kEk\" />\n    </div>\n  );\n});\n\nfunction App(props) {\n  const [cameraView, setCameraView] = useState(null);\n\n  useEffect(() => {\n    scCamera.goToSurface(cameraView);\n  }, [cameraView]);\n\n  return (\n    <Fragment>\n      <CameraContext.Provider\n        value={{\n          cameraView,\n          setCameraView\n        }}\n      >\n        <Surface {...farLeftWallProps}>\n          <Test />\n        </Surface>\n        <Surface {...middleLeftWallProps}>\n          <Embedded />\n        </Surface>\n        <Surface {...backWallProps}>\n          <Board />\n        </Surface>\n        <Surface {...middleRightWallProps}>\n          <MapTest />\n        </Surface>\n        <Surface {...farRightWallProps}>\n          <Test />\n        </Surface>\n      </CameraContext.Provider>\n\n      <div className=\"app\">\n        <div className=\"app__content\" />\n        <div className=\"app__overlay\">\n          {cameraView !== null && (\n            <div\n              className=\"app__back-to-overlay\"\n              onClick={() => setCameraView(null)}\n            >\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                width=\"48\"\n                height=\"48\"\n                viewBox=\"6 6 36 36\"\n              >\n                <path d=\"M40 22h-24.34l11.17-11.17-2.83-2.83-16 16 16 16 2.83-2.83-11.17-11.17h24.34v-4z\" />\n              </svg>\n              <div>\n                <span>Back to overview</span>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </Fragment>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport './render';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}